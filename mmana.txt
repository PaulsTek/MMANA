MMANA SOFTWARE MANUAL
=====================

                                     First edition 1999.01.10 JE3HHT Mori Cheng
                                     Revised 2000.07.07 JE3HHT Mori Cheng

----------------------
１．About MMANA
----------------------
MMANA is an antenna analysis software that uses the method of moments created based on "MININEC Ver3" developed by a US government research institute. As for the calculation engine, the BASIC source file is open to the public as PDS, and was ported to C++ (Borland C++Builder).

  現状では以下の機能を備えています。

  ・アンテナ定義のエディタ
  ・アンテナ形状表示、セグメント分割、電流分布表示
  ・水平パターン、垂直パターン表示と印刷
  ・複数の結果の比較
  ・エレメント編集
  ・ワイヤ編集
  ・異径パイプの組み合わせ設定
  ・最適化（jX, SWR, Gain, F/B, Elev, 電流）
  ・最適化結果一覧表示と手動修正
　・周波数特性の表示と印刷
　・各種データファイルの作成

  扱うファイルは以下の通りです。

  ・アンテナ定義ファイル（テキスト形式）
  ・計算結果ファイル（バイナリ形式）
  ・最適化シート（バイナリ形式）
　・電流ファイル（ＣＳＶテキスト形式）
　・近傍データファイル（ＣＳＶテキスト形式）
　・遠傍データファイル（ＣＳＶテキスト形式）
　・周波数特性データファイル（ＣＳＶテキスト形式）

  定義できる数には以下の制限があります。

  パルス数	８１９２個（デフォルト１２８０）
  ワイヤ数	５１２本
  給電点数	６４個
  集中定数	１００個

  なお本書はＭＭＡＮＡの使用方法を説明するもので、アンテナ解析の説明書ではありません。ＭＭＡＮＡを使用する上でモーメント法に関する若干の知識を必要としますが、それについては以下の図書を参考されると良いでしょう。

  ＣＱ出版 「パソコンによるアンテナ設計」 小暮 裕明編 1998.4.15
  ＣＱ出版  Ham Journal No.95 「特集:ｱﾝﾃﾅｼﾐｭﾚｰｼｮﾝの理論と実際」

　ＭＭＡＮＡを作成するにあたり、モーメント法やＭＩＮＩＮＥＣ、テーパリング等に関して、ＪＡ１ＷＸＢ松田さん（ＭＭＰＣ作者）の記事（HJ No95:モーメント法によるアンテナ特性解析ソフトウエアについて）を大変参考にさせて頂きました。有り難うございます。

　めんどうなので本書はWindowsのヘルプ形式のファイルにはしませんでした。読みにくいかも知れませんがご容赦下さい。また一般的なWindowsアプリケーションと共通する操作や機能に関しては解説を省略しました。

○ＭＭＡＮＡのアンインストールについて
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
　ＭＭＡＮＡはシステムレジストリおよびWindowsディレクトリ内にレジストリファイルを作成しません。ＭＭＡＮＡをアンインストールする場合は、ＭＭＡＮＡのフォルダ（ディレクトリ）をすべて削除するだけでＯＫです。

○最大パルス数について
~~~~~~~~~~~~~~~~~~~~~~
  計算可能な最大パルス数はデフォルトでは１２８０になっていますが、オプションメニューの環境設定で変更できます。

----------------------
２．アンテナ定義
----------------------
  「アンテナ定義」タブを選択すると、アンテナの各パラメータを設定する表のエディタになります（起動時デフォルトの画面）。ここではワイヤの配置座標、給電点、集中定数（リアクタンス装荷）等の定義を行います。

　ＭＭＡＮＡではこの画面に限らず（計算結果以外の）すべての表は、その表の中の各項目にカーソルを移動し、そこにキーボードで数値を入力するのが基本的な操作方法です。リターンキーのみを押すと現在の値の修正ができます。数値には数式を使用できます（「Append.Txt」を参照）。
　カーソルの移動はマウスでその位置をクリックするか、カーソルキーを使用します。またマウスの右ボタンを押すとポップアップメニューが表示され、挿入や削除、その他の操作ができます。これらの操作の手順はこのソフトの他の部分でもほぼ同じです（以下他の画面のそれらの操作説明は省略します）。

○ワイヤ定義
~~~~~~~~~~~~
　アンテナを構成する各ワイヤ（直線）の状態を定義します。

  Ｘ１	  ワイヤ始点位置の直交Ｘ座標（単位メートル or λ）
  Ｙ１	  ワイヤ始点位置の直交Ｙ座標（単位メートル or λ）
  Ｚ１	  ワイヤ始点位置の直交Ｚ座標（単位メートル or λ）
  Ｘ２	  ワイヤ終点位置の直交Ｘ座標（単位メートル or λ）
  Ｙ２	  ワイヤ終点位置の直交Ｙ座標（単位メートル or λ）
  Ｚ２	  ワイヤ終点位置の直交Ｚ座標（単位メートル or λ）
  Ｒ	  ワイヤ線の半径（単位ミリ or λ）
  ＳＥＧ  セグメント分割の方法

  ※ Ｒはワイヤ線の半径です。直径ではないので注意してください。
     ~~~~~~~~~~~~~~~~~~~~~~
  ※ Ｒにマイナスの値を設定すると、複数の半径のワイヤ（パイプ）
     を組み合わせることができます。詳細は「Append.Txt」を参照
     して下さい。

  ※ Ｒに０を設定すると、そのワイヤは計算対象から外れて絶縁され
     た状態になります。これ（絶縁ワイヤ）を利用した高度な定義方
     法があります。詳細は「Append.Txt」を参照して下さい。


　通常、Ｘ軸はブーム方向、Ｙ軸はアンテナの横の方向（エレメントの方向）、Ｚ軸は垂直（高さの）方向にします。Ｚ軸の値は、給電点またはアンテナの中心点を０にしておくと良いでしょう（計算の際に地上高はオフセットできます。バーチカルの場合は地面に接する部分のＺ軸の値を０にして下さい）。またＸやＹも中心を０として扱う事をお勧めします。

　２つ以上のワイヤが、ある点で接続されている場合は、必ずそれぞれの始点または終点のいずれかの座標は同じでなければなりません（でないと接続されていると判断されません）。例えば１本の水平ワイヤの中央に別の垂直ワイヤが接続されているＴ字型の構成のアンテナの場合は、水平ワイヤを中央で分割して、垂直ワイヤと交わる部分に接続点を置いた合計３本のワイヤとして形状を定義をする必要があります（アンテナ形状表示ではつながっているように見えるので注意が必要です）。


  ＳＥＧに設定する値はセグメント分割の方法に関り、次のように記述します。

	手動均等分割		正の値
	自動均等分割		０
	テーパリング		負の値または、DM1,DM2の連記

　なお、セグメント、テーパリング等については「Append.Txt」を参照して下さい。

  手動均等分割を行いたい場合はＳＥＧに正の値を設定します。この場合、設定した値でワイヤは均等に分割されます。

  自動均等分割を行いたい場合は０を設定します。この場合、分割幅は1/DM2λに近い値になります。

  テーパリングを行いたい場合は負の値を設定します。－１を設定すると分割幅は1/DM1λ～1/DM2λの範囲でテーパリングされます。－２を設定すると始点のみテーパリングされます。－３を設定すると終点のみテーパリングされます。
  －１，－２，－３以外の値を設定するとその値（絶対値）をDM1として、同様に1/DM2λまでテーパリングされます。例えば -200 を設定すると1/200λ～1/DM2λまでテーパリングされます。またDM1，DM2のように数字を２つ記述してそのワイヤだけテーパリングの開始と終了の両方を指定することもできます。例えば 600,60 と記述するとλ/600～λ/60までテーパリングされます。

	ＤＭ１	テーパリング開始時の間隔（=λ/DM1）
	ＤＭ２	テーパリング終了時の間隔（=λ/DM2）
	ＳＣ	テーパリングの変化の度合い（乗数）
	ＥＣ	テーパリングの端点のセグメント数

  テーパリングの変化の度合いは（１より大きく３以下の値を）ＳＣに記述します。ＳＣは分母の値をＤＭ１から開始し徐々に増やしていく際の乗数です（通常は２を設定します）。
　－２や－３を設定して片側だけテーパリングする場合は、ワイヤの中心位置とパルス位置が一致しなくなりますので注意して下さい。通常このような設定を行うのは異径パイプを組み合わせている場合ですので、パルス位置が中心位置になくても困らないと思います。
  ＥＣはテーパリングを行う際の端点のセグメント数（ＤＭ１のセグメントの数）です。例えば２を設定すると端から２個のλ/DM1間隔のセグメントを確保します。通常この値は１でＯＫですが、場合によっては正常な解が得られない場合がありますので、そのような場合はＥＣを増やしてみると良いでしょう（DBLDP.MAAを参照）。

　セグメントの分割数や分割方法は主にインピーダンスの計算精度に大きく影響が出ることが知られています。特にワイヤに折れ曲がりがあるループアンテナ等ではテーパリングを指定して折れ曲がり付近のセグメント間隔のみを小さくする事により、少ないセグメント数でも計算精度を改善させる事ができます。
  ワイヤに折れ曲がりがないアンテナでは均等分割を、ループ等の折れ曲がりのあるアンテナではテーパリングを指定すると良いでしょう。

　「波長表記」にチェックを付けると、ワイヤの座標値および半径の単位は、設計周波数の波長を１とする場合の比（単位λ）、チェックを付けないとメートル（半径はミリ）で扱います。ただしＭＭＡＮＡ内部ではすべてのデータは常にメートル単位で記録されていますので、波長表記の状態で設計周波数を変更したとしても元々の座標値が変更されるわけではありません（波長比を維持したまま設計周波数を変更したい場合は編集メニューの「アンテナのサイズ」を使用します）。

　「接続点連動」にチェックが付いていると、あるワイヤの座標を変更した際、そのワイヤに接続されている他のワイヤの接続点の座標も連動して変更されます。

  「スタック」ボタンを押すと、水平および垂直に展開するアンテナの数と間隔を設定するダイアログボックスが開きます（「Append.Txt」を参照）。

  なお八木やループアンテナなどではワイヤを３次元直交座標で定義するのは煩雑なので、編集メニュー内の「エレメント編集」を使用したほうが良いかも知れません。また複雑な形状のアンテナを定義する場合は「ワイヤ編集」を利用すると便利な場合があります。


○給電点
~~~~~~~~
  ＰＵＬＳＥ	パルス位置
  位相		給電点の位相
  電圧		給電電圧

  パルス位置は以下の規則で記述して下さい。

	W#C(#)	ワイヤの中心点からのオフセット
	W#B(#)	ワイヤの割当パルス開始点からのオフセット
	W#E(#)	ワイヤの割当パルス終了点からのオフセット

  	例	W1C	ワイヤ１の中心の位置
		W3C1	ワイヤ３の中心から１つ先の位置
		W2C-2	ワイヤ２の中心から２つ戻った位置
		W2B	ワイヤ２の先頭の位置
		W5E3	ワイヤ５の終了から３つ戻った位置

  位相は給電点が１つしかないアンテナでは０を設定します。ＨＢ９ＣＶ等のように１３５度進相給電のアンテナの場合は２つ目の給電点に１３５を設定します。

  電圧は普通は 1/給電点 の値を設定します。均等に給電しない場合はその配分比率で値を設定します（電圧の値そのものは特に重要ではありませんが、電流分布表示の際の振幅に影響します）。

※給電点を設定すると、そのパルス位置は極めて短いギャップで分離され、その両端に給電されると考えて下さい。また複数のワイヤが１点に接続された点に給電する場合の注意を「Append.Txt」に記載してありますので参照して下さい。


○集中定数（リアクタンス装荷）
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ＰＵＬＳＥ	パルス位置
  種類		LC，R+jX，Sのいずれか

　パルス位置の記述方法は給電点の場合と同じです。

　カーソルが種類の位置にある状態でリターンキーを押すと、種類を選択するためのポップアップメニューが表示されます。

  ＬＣを選択した場合は、Ｌ(uH)、Ｃ（pF）、Ｑをそれぞれ設定します。ローディングコイルのみの場合はＣを０に設定します。ローディングコンデンサのみの場合は同様にＬを０に設定します。
  ＬとＣの両方を設定すると並列共振回路のトラップになり、その共振周波数が表示されます。一旦この状態になると、以後片側を変更した場合は、その共振周波数を保ようにもう片側が自動的に連動します。連動すると都合が悪い場合は一旦ＣまたはＬに０を設定した後、その値を入力して下さい。
  ＬまたはＣに値を設定し共振周波数を入力すると、その周波数で共振するように、ＣまたはＬが設定されます。
  Ｑはローディングコイルの場合はコイルのＱを設定します。ローディングコンデンサの場合はコンデンサのＱを設定します。いずれもＱに０を設定すると特別に無損失として計算します。

  Ｒ＋ｊＸを選択した場合は、集中定数の純抵抗Ｒ（Ω）とリアクタンスＸ（Ω）をそれぞれ設定します。終端抵抗（無誘導抵抗）や、とりあえず回路を問わずに何等かのリアクタンスを入れたい場合はこの方法が簡単です。

  Ｓを選択した場合は、集中定数のＳパラメータ（Ａ０～ＡｎおよびＢ０～Ｂｎ）を入力します。階数ｎは入力した位置までで自動判定されます。直列－並列共振回路の組み合わせなど複雑な構造の回路を、周波数に影響されないパラメータとして記述したい場合はこの方法で記述します（詳細は「Append.Txt」を参照して下さい）。

  実際の記述方法は以下のサンプルを参照して下さい。

ローディングコイル	VDP40.MAA, VDP40B.MAA
ローディングコンデンサ	MAGLOOP.MAA, MAGLOOPC.MAA
トラップ		MULTDPH.MAA, MULTDPL.MAA, MULTDPW.MAA MULTDPHW.MAA
終端抵抗		T2FD.MAA, RHOMBIC.MAA, BEVERAGE.MAA
Ｓパラメータ		MCQM.MAA

※集中定数を設定すると、そのパルス位置に超小型の集中定数が直列に挿入されると考えて下さい。


----------------------
３．アンテナ形状
----------------------
  「アンテナ形状」タブを選択すると、現在定義されているワイヤの状態を表示します。既に計算済みの場合は電流分布も表示することができます。

　太い線で表示されているワイヤは、ワイヤ定義画面のカーソル位置のワイヤです。またこの画面で任意のワイヤを（左ボタンで）クリックすると、そのワイヤが選択状態（太い線）になり、ワイヤ定義画面のカーソルがその位置に移動します。
　複雑な形状のアンテナを編集する場合は、どのワイヤがどの位置になるかを見失いがちですので、この方法で確認すると良いでしょう。
　またダブルクリックするとそのワイヤに関する極座標編集のダイアログボックスが開きますので、長さや角度の変更はここで行う事もできます。

　マウスの右ボタンをクリックすると、ポップアップメニューが表示されます。そのクリック位置を画面の中心にしたり、給電点の設定・解除、ワイヤの平行移動や極座標編集等のワイヤの編集機能を呼び出す事ができます。

  以下に各ボタン等の説明を記します。

○全景ボタン
　このボタンを押すとアンテナの全景が画面内に収まるように表示します。

○原点ボタン
　座標原点（0,0,0）を中心にします。

○回転
　Ｘ軸を回転させます。

○視点
  視点（上下）を変更します（視点表示の時のみ）。

○縮尺
　表示縮尺を変更します。

○視点表示
  視点を考慮した３次元展開表示を行います。電流分布やセグメントの分割等を検討する場合はこのチェックを外したほうが見やすいかも知れません。

○電流分布を表示
　電流分布を表示します（計算済みでないと表示できません）。分布は色分けしていますが、これはワイヤのベクトルにより見易いように区別しているだけで特別な意味はありません。

○分割位置の表示
　セグメントの分割状態を表示します。テーパリング等が希望の状態になっているかを確認する場合にチェックを付けます。

○電流の振幅
　電流分布の表示振幅を変更します。自動調整しても良かったのですが、勝手に変わると比較しにくいので、手動で設定するようにしました。表示振幅の大きさは縮尺の影響も受けます。

※モデル化したワイヤ定義が正しく扱われているかどうかを知るために、必ず電流分布を確認することをお勧めします。分布が予想した状態と異なる場合は、正しく計算されていないと推測できます。また変化が粗いと感じる場合は精度が確保されていないと推測できます。このような場合はワイヤの接続状況の確認、セグメントの分割数、分割方法を再検討すると良いでしょう。

----------------------
４．計算
----------------------
  「計算」タブを選択すると計算のためのウインドウに切り替わります。計算ボタンを押すと計算を開始します。

  計算条件として以下のパラメータを指定しなければなりません。

  周波数	計算させる周波数（通常は設計周波数と同じ）
  計算条件	大地の条件
  地上高	計算条件で自由空間以外を選択した場合
　メディア　　　リアルグランドの場合の大地の状態
　ワイヤ	ワイヤのロスを計算に含める場合の材質

  リアルグランドを選択した場合、「MININEC3」のアルゴリズムでは、パターン図を得るための遠方電界強度の計算にのみ影響し、インピーダンス計算では完全導体グランドと仮定されますので注意が必要です（地上高が波長と比較してかなり低い場合は実際よりＺが低めに出ます）。
  地上高はアンテナの全体のＺ軸方向のオフセット（ｍ）を入力します。ＭＭＡＮＡは完全導体グランドまたはリアルグランドが選択された場合、この地上高の値を単純にＺ軸のオフセットとします。

  計算ボタンを押しても計算が開始されない場合は、右上のログウインドウにその原因が表示されます。また浮動少数点に関するエラーが発生した場合はメッセージボックスが表示されますので、アンテナ定義に矛盾がないか再確認して下さい。

  計算結果は最新のものが表の先頭に表示されます（この表は結果表示のみで編集はできません）。ＳＷＲはデフォルトでは５０Ωシステムの場合の値です（６００Ωシステムの場合を知りたい場合はパターン図表示を参照して下さい）。またオプションメニューの環境設定でＳＷＲ計算インピーダンスを変更する事もできます。
　給電点を複数設定している場合は、最初の給電点の情報を結果として表示します。他の給電点について知りたい場合は、ログウインドウを参照して下さい（ログウインドウをクリックするとカーソルが表示されます。その状態で↑キーを押すとスクロールバックできます）。

　Ｆ／Ｂ比を算出する際、真後ろからある範囲（デフォルト１２０°）の角度をチェックし最悪値と比較しています。この範囲角は表示メニュー内のオプションで自由に変更できます。
　Ｇａは絶対利得、Ｇｈは単純に2.15dBを減算しています。グランドありで計算した場合Ｇｈは表示されません。

　ＭＭＡＮＡは結果の表示に関して計算精度や有効桁数をあまり考慮していません。特にインピーダンスは細かく表示されますが、これは極めて低インピーダンスになった場合の有効桁を確保するためです。他の値に関してもその評価は現実的な誤差範囲内で行ってください。

　メディアは遠方電界強度計算（パターン図計算）の際に参照されます。大地の状態を表わすパラメータとして比誘電率と導電率（単位mS/m）の組み合わせを設定して下さい（「Append.Txt」を参照）。
　なお２つ以上の組み合わせを設定する場合は、それぞれのＸ軸方向の距離と高さも設定して下さい（MININECにはグランドスクリーンを仮想して計算するコードもありましたので、一応それも設定できるようにはしてあります）。

　ワイヤのロスについては、磁気ループの解析を行う際に必要になり、組み込んでみました。線を選択した場合は、すべて単線として扱います。パイプを選択した場合は、その肉厚は直径の１０％（例えば10mmΦのパイプは1mm）と仮定します。
　資料を調べると鉄線は比透磁率が１２０～２００００とあいまいだったので、とりあえず１５０として計算しています（比透磁率が大きいほど表皮効果は激しい）。
　なお普通の（インピーダンスがまともな）アンテナでは、銅やアルミを使っている限り、無損失で計算しても問題ありません（無損失のほうが計算は早い）。

※デフォルトでは計算可能なパルス数が１２８０になっています。不足する場合はオプションメニューの環境設定で変更してください。

----------------------
５．パターン図表示
----------------------
  「パターン」タブを選択するとパターン図表示のウインドウに切り替わります。左が水平面、右が垂直面のパターン図です。
  垂直面のパターンは水平面Ｘ軸を縦割りした結果です。水平面のパターンは垂直面ピークの仰角（打ち上げ角）での結果です（仰角は水平線を０°、Ｚ軸方向を９０°とした値で扱います）。
  ただし打ち上げ角が８７°以上の場合は、その仰角での水平パターンを見てもあまり意味がないので、とりあえず仰角４５°での水平パターンを表示するようにしてあります。
  この水平パターンの計算仰角を変更するには「水平パターンの仰角」ボタンを押します。新しい仰角を入力するとその仰角で再計算します（Ｆ／Ｂ比等も再計算されます）。

  いずれのパターンも表示の角度分解能は１°単位ですが、打ち上げ角は０．１°単位で得ることができます。ただし地上高が波長に対して極端に高くなると垂直面ビームの半値角が極めて狭くなり、真のピークを検出できない場合があります。特に1.2GHz等の高い周波数ではそうなりがちなので注意して下さい。

　「表示する偏波」で、水平偏波、垂直偏波のそれぞれの電界強度パターンを選択できます。重畳を選択すると両方の偏波のパターン図を重ねて表示します（主要偏波が黒色）。

　「印刷」ボタンを押すとプリンタの設定ダイアログボックスが表示されます。「ＯＫ」ボタンを押すと、現在表示されているパターン図を印刷ジョブに送ります（重畳の場合、色分けはされません）。用紙の選択等は「プロパティ」ボタンを押して設定して下さい。ＭＭＡＮＡは選択されている用紙に合わせて印刷の大きさを調整しますので、どのような用紙でもそれなりに印刷できます。
　ビットマップで保存するには、キーボードの「PrintScrn」キーを押して、画面をクリップボードに保存し、ペイントブラシを起動して「貼り付け」を実行します。この操作はWindowsが標準で提供していますが、意外と知られていないので覚えておくと便利です。

----------------------
６．エレメント編集
----------------------
  編集メニューの「エレメント編集」を選択するとエレメント編集画面に切り替わります。八木やループ、その他のワイヤが複合されたエレメントを３次元直交座標で定義するのはあまりにもめんどうなのでこの機能を組み込みました。ここでは横幅、縦幅、全周、エレメント間隔などの判りやすいパラメータで編集する事ができます。
  マウスの右ボタンをクリックすると、ポップアップメニューが表示されますので、形状の変更等の必要な操作を行う事ができます。

　ＭＭＡＮＡはまず各ワイヤの接続状況を調べ、同じ座標位置を含むワイヤは接続されているとみなし大きなグループ（エレメント）分けを行います。次に個々のエレメントの形状を各ワイヤのベクトルを調べて解析します。この際、例えばヘンテナループや双ループのように、１つのエレメント内にループが複数ある場合は、そのワイヤ定義の順番により形状解析結果が異なります。これは最適化の際のパラメータとしてどの部分を変更するかに関りますので、希望と異なる場合はエレメント内のワイヤ定義の順序を変えてみると良いでしょう（順序を変更するには編集メニューの「テキストで編集」を使用すると簡単です）。

　なおエレメント編集中に、いずれかのエレメントを削除（または形状の変更）すると、元のワイヤ定義の順番が変更される可能性がありますので注意して下さい（給電点や集中定数の位置を補正する必要が生じます）。

　まったく新規に作成する場合は、八木の場合は横幅（または縦幅）、ループの場合は全周に何等かの数値を入力するところから始めます。ループの場合は、デフォルトが垂直□ですので、都合が悪い場合は形状のところでリターンキーを押し、ポップアップメニューの形状の変更を選択して下さい。
　以後、新規の位置に、間隔、横幅、全周等に数値を入力していくと、それらのエレメントが追加されます。リフレクタを定義したい場合は、基準位置のエレメントにカーソルがある状態でマウス右ボタンを押し、「この位置に挿入」を選択します。

　エレメントを追加する場合は、その前後のエレメントの状態がそのままコピーされます。キャパシティハットを付加している等の複雑な構造のエレメントの場合は、まずラジエータの構造をワイヤ定義画面で適当に作成すれば、後はエレメント編集で同じ構造のエレメントを簡単に追加できます。

  「端点のみ変更」を選択している場合、複数のワイヤで構成されるエレメントは、その端点の座標のみが変更されます（デフォルト動作）。「すべての座標を同一比率で変更」を選択している場合、関連するワイヤのすべての座標を同一比率で変更します。この動作の詳細については「Append.Txt」を参照して下さい。

　間隔は常に隣（基準位置方向）に定義するエレメントとの間隔を設定して下さい。例えば３バンドの３エレのクワッドの場合は、

No.	間隔		エレメントの種類	備考
1	0.0		１４の反射器		No2と同じ位置
2	0.0		２１の反射器		No3と同じ位置
3	2.5		２８の反射器		No4から2.5ｍ後方
4	基準位置	１４の輻射器
5	0.0		２１の輻射器		No4と同じ位置
6	0.0		２８の輻射器		No5と同じ位置
7	2.0		１４の導波器		No6から2ｍ前方
8	0.0		２１の導波器		No7と同じ位置
9	0.0		２８の導波器		No8と同じ位置

のような順序で記述すると良いでしょう。この場合、例えばNo3のエレメントの間隔を変更すると、No1とNo2のエレメントの位置もNo3と常に同じになります。
　ＭＭＡＮＡはワイヤ定義からエレメント編集への解析を行う際、Ｘ軸が最も座標０に近いエレメントを基準位置として扱います。

　Ｘ軸に幅があるエレメント（例えばキャパシティハットが付加されている）の場合は、そのＸ軸の幅（Ｘ幅）も変更できます。この場合、Ｘ幅はそのエレメント全体のＸ座標の中心点からの相対関係で設定されますので、できれば本体のエレメントが幅の中心になるようにキャパシティハットを配置しておくと良いでしょう（要するにキャパハットは本体エレメントを中心にして対象に展開するのが好ましい）。

  「間隔表記」にチェックを付けるとエレメントの間隔、チェックを付けないとエレメント１番を０とした累計位置で表記します。

　「波長表記」にチェックを付けると、ワイヤの横幅や全周および半径等の単位は、設計周波数の波長を１とした場合の比（単位λ）、チェックを付けないとメートル（半径はミリ）で扱います。

  マウス右ボタンを押し「印刷」を選択すると、現在の状態を印刷します。同様に「CSVファイルの作成」を選択すると、現在の状態をCSVファイルに出力します。表計算ソフト等で参照すると良いでしょう。


----------------------
７．ワイヤ編集
----------------------
  編集メニューの「ワイヤ編集」を選択するとワイヤ編集画面に切り替わります。ここではマウス操作により、ワイヤの追加や座標の変更を行う事ができます。以下の４つの画面があります。

・全景タブ	アンテナ形状を３次元展開して表示
・Ｘ－Ｙタブ	アンテナを上から眺めた状態で表示
・Ｘ－Ｚタブ	アンテナを側面から眺めた状態で表示
・Ｙ－Ｚタブ	アンテナを正面から眺めた状態で表示

　右側に表示されているスライドやボタン等は以下の通りです。

・縮尺スライド　	表示縮尺を変更します。
・矢印ツールボタン	選択モードにします。
・直線ツールボタン	新規のワイヤを追加するモードにします。
・正方形ツールボタン	新規のワイヤをループ状に追加するモードにします。
・表示			選択中のワイヤと同一面または接続されている
			ワイヤのみ表示します。
・グリッド表示		グリッドの表示を切り替えます。
・グリッド幅		グリッドの幅を設定します（縮尺による制限あり）。

　画面内でマウスの右ボタンを押すと「ポップアップメニュー」が表示され、以下の機能を利用する事ができます。

・この位置を中心にする
　マウスの右ボタンを押した時の位置を画面の中心にします。
・座標原点を中心にする
　座標原点（0, 0, 0）を画面の中心にします。
・近接端点に接続
　選択中のワイヤの端点を最も近い他のワイヤの端点に接続します。
・端点を分離
　選択中のワイヤの端点を他のワイヤから分離します。
・軸中心に配置
　選択中のワイヤを基準軸に対して中心に配置します。
・このワイヤを２分割
　選択中のワイヤを２分割します。分割された残り半分は、新規のワイヤとして定義されます。
・このワイヤを削除
　選択中のワイヤを削除します。
・グリッド原点
　グリッド原点を変更します。

　選択しているワイヤは赤色、他のワイヤは黒色で表示されます。端点は他のワイヤが接続されている場合は×印、接続されていない場合は□印で表示されます。「ワイヤの２分割」や「端点の分離」、「近接点に接続」等を駆使すると、ＬＰＤＡ等の複雑な形状のアンテナでも比較的簡単に定義する事ができます。

○選択モードでのマウス操作
　右上にある矢印ツールボタンを押すとワイヤの選択モードになります。ワイヤをクリックするとそのワイヤが選択されます。
　選択しているワイヤの端点にマウスを近づけると、カーソルが十字になりますので、その状態でドラッグするとその端点を移動する事ができます。この時「Shift」キーを押しながら操作すると、ワイヤが水平または垂直になるように端点を移動します。「Ctrl」キーを押しながら操作すると、ワイヤの長さを一定に保って、角度だけ変更するように移動します。
　選択しているワイヤの中点にマウスを近づけると、カーソルが□＋矢印になりますので、その状態でドラッグするとそのワイヤ全体を移動する事ができます。この時「Shift」キーを押しながら操作すると、ワイヤが水平または垂直に平行移動します。
　画面が全景タブの場合は、端点を移動して他のワイヤの端点に接続する操作のみ可能です。

○直線定義モードでのマウス操作
　右上にある直線ツールボタンを押すと新規にワイヤを定義するモードになります。始点から終点にマウスをドラッグすると、そのワイヤが新規に定義されます。この時、右側のワイヤのパラメータを表示している部分をクリックすると、そのワイヤを数値で編集する事もできます。
　画面が全景タブの場合は、既に存在するワイヤの端点から他のワイヤの端点にワイヤを接続する状態でのみ追加する事ができます。

○ループ定義モードでのマウス操作
　右上にある正方形ツールボタンを押すと新規にループワイヤを定義するモードになります。始点から終点にマウスをドラッグすると、その長方形を構成する４本のワイヤが新規に定義されます。
　画面が全景タブの場合は、この操作はできません。

----------------------
８．最適化
----------------------

  ビームアンテナ等の解析をしていると、必ず１回は、エレメントの幅や間隔などを手動で適当に修正し、ゲインやＦ/Ｂ比を最大にする遊びに興じることになります。またボトムロード以外のローディングコイルは、そのＬを計算するのがやっかいなので、これも適当に値を設定してｊＸが小さくなる点をカット・アンド・トライで探す作業になります。
  私もこのソフトを作りながら何度かやりましたが、その繰り返し作業があまりにも煩雑だったので、自動で最適な状態になるよう計算を試行する機能を組み込んでみました。

  表示メニューの「最適化」または計算画面の「最適化」ボタンを押すと、最適化を行うための設定ウインドウが開きます。

  設定できる最適化目標は以下の通りです。

  ・ｊＸの値を最小にする（共振させる）
  ・ＳＷＲの値を最小にする
  ・Ｇａの値を最大にする
  ・Ｆ／Ｂの値を最大にする
  ・Ｅｌｅｖ（打ち上げ角）を最小にする
　・マッチング回路
  ・電流を最大または最小にする

  上記の目標は大概のケースでお互いに妥協関係にありますので、それぞれどの程度重視するかを画面上のスライドで設定する事ができます。スライドを右にすれば、その目標は重視され、左にすると軽視されます。左端にすると目標としてまったく評価されなくなります。

  「最適化目標なし」にチェックを付けると、スライドの状態に関らず最適化は行われず単純スイープ動作になります。この場合、変数は現在値からプラスの方向に指定したピッチ（固定ピッチ）で増加しＭａｘの値になると終了します。単純スイープは周波数や地上高などに対する目標の変化をつかみたい場合に使用すると良いでしょう。

　「詳細ボタン」を押すと、目標の許容できる最大値を細かく設定できます。例えばＦ／Ｂ比は２０ｄＢ確保できれば十分であると考えるならば、その値を設定しておくと、それ以上になった場合に、評価の比率配分を他の目標により多く配分する事ができます。

　「バンドボタン」を押すと、試行するバンドの周波数とそれぞれの給電点を設定するダイアログボックスが表示されます。マルチバンドアンテナを総合評価する場合は、そこに周波数と給電点の対応を設定して下さい。デフォルトは試行バンドは１つで給電点は現在の状態になっています。

　マッチング回路は、ヘアピンマッチ、キャパシタンスマッチ、または任意のＺを目標にします（詳細ボタンを押して選択）。ヘアピンマッチの場合はｊＸはマイナス（容量性）、キャパシタンスマッチの場合はｊＸはプラス（誘導性）になります。

  電流は指定したパルス位置の電流が最大または最小になることを目標にします。パルス位置および最大／最小の選択は詳細ボタンを押して設定して下さい。

  試行の際に可変できるパラメータは以下の通りです。

  ・ワイヤの座標、半径
  ・ワイヤの長さ、径度、天頂角（極座標表現）
  ・エレメントの幅や全周、半径等
  ・集中定数の値
  ・地上高
  ・周波数
  ・給電点の位相、電圧
  ・スタックの間隔

　ＭＭＡＮＡは上記のパラメータを最大１２８個の変数として個別に設定できます。カーソルが種類の位置でリターンキーを押すと、種類選択のポップアップメニューが表示されます。またカーソルが箇所の位置でリターンキーを押すと箇所選択のポップアップメニューが表示されます。その他は直接数値を入力します。

○ワイヤの座標、半径
~~~~~~~~~~~~~~~~~~~~
  最も原始的な変数です。ワイヤ定義されているX,Y,Z座標の中のX1,X2,Y1,Z1,Y2,Z2,Rに関して、それぞれ可変する事ができます。
  指定したワイヤの座標が変化した場合、その点に接続されている他のワイヤの座標（接続点）も同時に変更されます。
  この方法はより細かい最適化を行いたい場合に使用し、ビームアンテナ等の一般的な最適化の場合は、エレメントによる設定をしたほうが簡単かも知れません。
  位置はワイヤ番号、変数の単位は常にメートルです。

※ Ver1.65以降では、従来エレメントオフセットでしか扱えなかったX軸値が、実値で扱えるようになっています。

○ワイヤの長さ、径度、天頂角（極座標表現）
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ワイヤを極座標表現として扱う変数です。ワイヤの長さや角度などを基準点からの相対関係で可変できます。逆ＶやＶビームの長さや角度を最適化する場合はこれを使用すると良いでしょう。ただしＸ軸が可変される場合は、次に解説するエレメント間隔や位置を同時に可変パラメータにしないで下さい（禁止はしていませんが、最適化一覧の更新機能で希望通りの状態に更新できない場合があります）。
  指定したワイヤの座標が変化した場合、その点に接続されている他のワイヤの座標（接続点）も同時に変更されます。
  位置はワイヤ番号、変数の単位はメートルまたは度です。

○エレメント
~~~~~~~~~~~~
  エレメント編集で設定できる項目を可変パラメータとして設定できます。例えば八木の場合はエレメントの間隔、位置、横幅、ループの場合は間隔、位置、全周等です。
  位置はエレメント番号、変数の単位は常にメートルです。

※ Ver1.53以降では、従来のエレメントの「間隔」の代わりに「位置」を指定する事もできます。ブーム長を固定して内側のエレメントの間隔を最適化したい場合には、内側のエレメントの「位置」をパラメータとして指定すると良いでしょう。
※ Ver1.75以降では、複数のワイヤで構成されている場合、横幅（全）、縦幅（全）、全周（全）を指定して、それぞれ先端の座標だけではなく、関連する途中のワイヤの座標を同一比率で変更する事もできます（Append.Txtを参照）。

○集中定数の値
~~~~~~~~~~~~~~
  ＬＣまたはＲ＋ｊＸタイプの集中定数に関して、それぞれの値を可変できます。ローディングＤＰや八木等のように両端の２つの集中定数を同時に変更させたい場合は片側に「連携」を指定すると良いでしょう。
　ＬＣタイプの場合にＬとＣの両方が設定されている集中定数はトラップであると判断し、その共振周波数が変化しないように、片側を変更すると、もう片側の値も連動します。例えばＬを増加させるとＣが減少して常に同じ共振周波数になるように設定されますので注意して下さい。
  位置は集中定数番号、変数の単位はＬはuH、ＣはpF、ＲはΩです。

○地上高
~~~~~~~~
  位置はありません。変数の単位はメートルです。

○周波数
~~~~~~~~
  位置はありません。変数の単位はMHzです。複数のバンドを設定している場合はこのパラメータを変数としないで下さい。

○給電点
~~~~~~~~
  給電点の位相および電圧を可変します。
  位置は給電点番号、変数の単位は位相は度、電圧はＶです。

○スタックの間隔
~~~~~~~~~~~~~~~~
  位置はありません。変数の単位はｍです。箇所に「間隔」を選択した場合、水平および垂直の両方が同じ値に設定されます。


  表内の「連携」に０を設定するとその変数は独立変数になります。０以外の正の値を設定すると、その番号の変数と同じ値が設定されます。マイナスの値を設定するとその番号の変数と同じ値をマイナスにしたものが設定されます。また演算子を続けて簡単な演算式を設定する事もできます（使用可能な演算子は＋，－，＊，／の４つ）。

［連携の例］
	0		連携なし（独立変数）
	1		変数１の値に連携（変数１と同じ値が設定される）
	-5		変数５のマイナスの値（5*-1と等価）に連携
	1*1.05		変数１の値を１．０５倍した値に連携
	2-1.5		変数２の値から１．５を減算した値に連携
	-3+1.2		１．２から変数３の値を減算した値に連携

  例えばマルチバンドの水平ＤＰの途中に入っているトラップの位置を最適化したい場合は、左右のトラップの位置（Ｙ１とＹ２）の２つの変数を定義し、Ｙ１は独立変数（連携＝０）、Ｙ２はＹ１のマイナスの値に連携（連携＝－１）させると良いでしょう（ただし中心のＹ座標は０でなければなりません）。
  上記の連携関係を一発で設定するには、まず変化させる目的の変数を１つ設定し（連携＝０）、カーソルがその行にある状態でマウスの右ボタンを押します。ポップアップメニューが表示されますので「自動連携登録」を選択して下さい。その独立変数に関連する（とＭＭＡＮＡが推測する）ワイヤを連携変数として追加します。
　この方法はヘンテナやトライハットの真ん中のワイヤを平行移動させる場合にも応用できます。

  表内の「ピッチ」は試行する最小の変数の幅を絶対値またはパーセントで設定します。この値を大きくすると収束時間が短くなりますが、得られる結果は満足できないかも知れません。  

  表内の「Ｍｉｎ」は、その変数の最小値、「Ｍａｘ」は最大値で、それぞれその値以下、または以上にはならないように最適化を行います。数値を記述せずに先頭に＃を付けて変数番号を指定すると、他の変数の値を最大値、最小値とする事もできます（例えばMax欄に #1 と記述すると、Max値は変数１の値になります）。
  ビームアンテナのエレメントの間隔は最大値を設定しておかないと、予想以上に大きなアンテナになる場合があります。また横幅や全周等の最小値を設定しておかないと、各エレメント間隔の初期値が適当でない場合は、例えば５エレの中の１本のエレメントが極端に短くなり、結果として４エレ動作になったりもしますので注意して下さい。最適化実行中は「アンテナ形状」を表示させて極端におかしな形状になっていないか確認しておくと良いでしょう。

　「削除」ボタンを押すと、現在のカーソル位置の変数が削除されます。

　「全エレメント」ボタンを押すと、とりあえず可変できるエレメントの各箇所を、すべて自動的に可変パラメータとして登録します。
  この時、エレメント編集画面またはエレメント参照画面で、「間隔表記」にチェックを付けている場合はエレメントの「間隔」、チェックを付けていない場合は「位置」が変数として使用されます。
  このボタンの詳細については「Append.Txt」を参照して下さい。

　「エレメント参照」ボタンを押すと、エレメント選択画面を表示しますので、可変したい箇所にカーソルを移動し「ＯＫ」ボタンを押してください。その位置を可変パラメータとして登録（または変更）します。エレメント選択画面で＊印が付いている箇所は既に可変パラメータとして登録されている事を意味します。また「ワイヤ選択」タブを押すとアンテナ形状が表示されます。この時、いずれかのワイヤをクリックするとそのワイヤが太い線に変わり、「ＯＫ」ボタンを押すとそのワイヤが変数として登録されます（ワイヤの箇所は表のほうで設定する必要があります）。ワイヤ選択画面で既に変数として登録されているワイヤは赤色で表示されます。

  「ピッチは絶対値」のチェックを付けている場合、ピッチの値はその変数の絶対値、チェックを付けていない場合はパーセントで指定して下さい。

  「分解能２°」のチェックを付けると、パターン計算の際の分解能を２°毎にします（通常は１°毎なので計算が少し早くなりますが、高い周波数のアンテナをグランドありで計算する場合は精度に問題があります）。

　「ログの表示」のチェックを付けると、最適化実行中の試行状況が計算画面のログウインドウに表示されます。

　「閉じる」ボタンを押すと、このダイアログボックスは消えますが、それまで設定した目標配分や可変パラメータ等の設定内容を失う事はありません。計算画面で「最適化」ボタンを押すと閉じた時の状態で再度表示されます。

　「実行」ボタンを押すと最適化を開始します。なお最適化実行中でも、ワイヤ定義、アンテナ形状、パターン図など、左上のタブをクリックすると、その画面に切り替える事ができ、各状態の変化を見ることができます（ただし計算に没頭していますので、画面の切り替え等、マウスの応答はとても遅いです）。
  またＭＭＡＮＡはWindows管理下で動作していますので、当然ながら最適化実行中も他のアプリケーションで別の作業をする事ができます（パフォーマンスは落ちます）。またＭＭＡＮＡ自身の同時起動を禁止していませんので、例えばＭＭＡＮＡを２つ起動し、片方で最適化を実行させて、もう片方では別のアンテナの解析をするという事もできます。
  「Append.Txt」内に「最適化のヒント」という項目がありますので、併せて参照してください。


----------------------
９．最適化一覧
----------------------
  最適化計算を行い実行経過を見ていると、自分が良いと思った状態が必ずしも最適結果と判定されないケースがあります。これは妥協関係の設定が意図したものと異なっていたり、また現状では妥協関係の評価関数がチューニング不足でＭＭＡＮＡが算出する評価値と人間の感覚が一致していないのが原因です。

  表示メニュー内の「最適化一覧」または計算画面の「最適化一覧」ボタンを押すと、最適化計算を行う際に試行したそれぞれの結果（最新の１２８個）の一覧を表示させる事ができます。
  更にここで「更新」ボタンを押すと、その時の状態にアンテナ定義を修正する事ができますので、ある程度は評価の修正を後から手動で行う事ができます。

  最適化一覧で表示されるパターン図はメモリを節約するために、２°分解能、１６ビットの固定小数点（1/256）精度です。

----------------------
10．周波数特性
----------------------
　計算ウインドウの「周波数特性」ボタンを押すと、現在のアンテナの周波数特性を計算するためのダイアログボックスが開きます。
　この機能を使用するには、少なくとも１回はそのアンテナに関して任意の周波数で計算されていなければなりません。

　「推測」ボタンを押すと、現在の周波数から少しずれた１点だけ解析計算し、その前後の特性を推測します。推測するＲ、ＧＡ、Ｆ／Ｂの各値は直線近似です。ｊＸとＳＷＲはアンテナの固有のＬとＣを計算しその値を元に推測します（アンテナを直列共振回路と仮定します）。パターン図は推測できません。Hi

　「全点」ボタンを押すと、すべての点（５点）について解析計算し結果を表示します。

  「詳細」ボタンを押すと、さらに細かい中間点について解析計算し結果を表示します。周波数範囲を広く取っている場合に使用すると良いでしょう。追加計算する中間点の数は「プロパティ」画面で設定する事ができます。

  「共振」ボタンを押すと、そのアンテナの共振周波数を求める計算を行い、結果はＺ表示グラフのｆｏで表示されます。共振周波数から非常に離れている状態で開始すると、収束させるのに予想外の時間がかかる場合がありますので注意してください。

　「プロパティ」画面では、マッチングセクションを追加して計算するかどうかの選択を行う事ができます。マッチングセクションは無損失の集中定数型ＬＣマッチを想定しており、これをＯＮにすると常に中心周波数、または指定した周波数で完全にマッチングをとった状態にします。

　Ｚ表示グラフの左上に表示される数値は以下の意味があります。

	Ｌ：そのアンテナの実効インダクタンス（ｊＸの変化から計算）
	Ｃ：そのアンテナの実効容量（ｊＸの変化から計算）
	Ｑ：共振回路のＱ（Q = sqrt(L/C)/R）
	Ｂ：半値幅（B = fo/Q）
	fo：共振周波数（ＬとＣから計算）

　上記の値はアンテナが直列共振回路であると仮定して、ｊＸの変化から得たものですので、アンテナの種類によってはまったく意味をなさない場合があります。また計算周波数が共振周波数から大きくずれている場合は誤差が大きくなると考えてください。
　Ｑおよび半値幅Ｂは共振回路の帯域を表わしますので、Ｂの値が大きいと（Ｑの値が小さいと）広帯域であると言えます。ただし損失を含む集中定数が入っている場合は、見かけのＲが大きくなり、それに伴いＢも大きくなりますが、アンテナの効率も低下していますので喜ばないで下さい。なおアンテナが電圧給電で共振している場合は、並列共振回路にモデル化する必要がありますのでこの計算での評価は不適当です。

  パターン図画面では、最初はすべての周波数のパターンが重ねて表示されるようになっていますが、表内の周波数の位置をクリックすると、その周波数のパターンのみ表示されるようになります。他の周波数のパターンを重ねて表示したい場合は、その行の「ＯＮ」の位置をクリックして下さい（○印がトグルし、表示がＯＮ／ＯＦＦされます）。なお、計算されていない周波数のパターン図は表示されません。

※パターン図は、２°分解能、１６ビットの固定小数点（1/256）精度です

　「印刷」ボタンを押すと印刷設定ダイアログボックスが表示されます。「ＯＫ」ボタンを押すとＺ、ＳＷＲ、ＧＡ／ＦＢの３つのグラフが１枚の紙に収まるように印刷します。この場合も用紙の大きさによって印刷の大きさが変わりますので、どのような用紙が選択されていてもそれなりに印刷できます。

※パターン図は印刷できません。


------------------------
11．編集メニューの小技
------------------------
○検索と置換
~~~~~~~~~~~~
　ワイヤの座標値、半径、ＳＥＧの値を検索し置換します。検索は常にワイヤ定義全体に渡って行われます。一括して値を変更する場合には便利です。
　「絶対値を検索」にチェックが付いていると、例えば－３と３は同じとみなされ、検索する値が３ならば、いずれも置き換えられます。ただし置き換える値の符号関係は前の状態を維持していますので、４に置き換えた場合は、それぞれ－４と４が新しい値に設定されます。

○座標の交換
~~~~~~~~~~~~
　定義されているすべてのワイヤのＸとＹ、ＸとＺ、ＹとＺについて値を入れ替えます。水平系で設計したアンテナを垂直にして動作させる等の実験ができます。

○アンテナのサイズ
~~~~~~~~~~~~~~~~~~
　定義されているすべてのワイヤの座標関係を、拡大または縮小します。特定の周波数で設計したアンテナを他のバンドに変更したり、設計周波数を微調する場合に使用します。ワイヤの半径も同様に変更すると、自由空間の場合はすべての特性に関して互換性があります（集中定数を使用している場合を除く）。

　通常、アンテナの共振が目的の周波数から若干ずれている場合は、ｊＸを目標にして最適化すれば良いのですが、アンテナの構造が複雑な場合は時間もかかりますし、得られる結果が満足できるという保証もありません。
　そこでまず周波数特性の「共振」ボタンを実行し、現在の共振周波数（＝ｆｏ）を求めます。
　次にその周波数をワイヤ定義画面の設計周波数に設定した後、このメニューを開いて目的の周波数を選び、サイズを換算変更すると比較的簡単に目的の周波数で共振状態にする事ができます。この時、ずれが同一バンド内の近い周波数の場合はワイヤ径は変更する必要はありません。

　上記の手法はアンテナの共振周波数が大きくずれている場合にも応用できます。その場合は、周波数特性で共振周波数を求める際に、幅（グラフ横軸の周波数幅）を大きく設定すると良いでしょう。


○値を丸める
~~~~~~~~~~~~
　定義されているすべてのワイヤの座標、半径、および集中定数の値を四捨五入して丸めます。アンテナサイズの一括変更や、最適化を行った後は中途半端な値になりますので、現実的な工作精度に丸めて再計算すると良いでしょう。

○極座標編集
~~~~~~~~~~~~
　ＭＭＡＮＡのワイヤ定義は３次元の直交座標系で定義しますが、ある角度を持ったワイヤの場合は、その長さ（＝動径）、径度、天頂角といった極座標表現で編集したほうが判りやすい場合があります。
　このメニューを選択すると、現在選択されているワイヤについて極座標表現での編集ができます。また長さや角度を変更した場合は、そのワイヤに接続されている他のワイヤの座標も連携して変更する事もできます。

○平行移動
~~~~~~~~~~
　このメニューを選択すると、現在選択されているワイヤ、またはすべてのワイヤを指定した軸の方向に平行移動する事ができます。移動する距離がプラスの場合は指定した軸の方向、マイナスの場合は指定した軸と逆の方向に移動します。例えばヘンテナの給電ワイヤを平行移動させる場合等に使用します。

○テキストで編集
~~~~~~~~~~~~~~~~
　このメニューを選択すると簡単なテキストエディタを起動し、現在のアンテナ定義をテキスト形式で編集する事ができます。マウス右ボタンを押すとポップアップメニューが表示されカット＆ペースト等を行う事もできます。CTRL-C,CTRL-X,CTRL-V等の編集のためのWindowsの標準的なショートカットキーも使用できます。

○組み合わせワイヤ設定
~~~~~~~~~~~~~~~~~~~~~~
  このメニューを選択すると組み合わせワイヤの設定画面を表示します。組み合わせワイヤを使用すると、１本のワイヤ定義で、複数の異なる半径のワイヤ（パイプ）の組み合わせを簡単に実現できます。詳細は「Append.Txt」を参照して下さい。


----------------------
12．オプション
----------------------
　表示メニューの中の「オプション」を選択するとダイアログボックスが開きます。ここでは共振、空芯コイル、マッチング回路、スタブ等の各種計算や、ＭＭＡＮＡの環境設定を行う事ができます。

○共振
~~~~~~
　周波数とリアクタンスからＬおよびＣの値、ＬやＣからリアクタンスの値、またはＬとＣから共振周波数をそれぞれ計算する事ができます。

○空芯コイル
~~~~~~~~~~~~
　Ｌから空芯コイルの各パラメータ（直径や巻数等）、または逆に空芯コイルの各パラメータからＬを計算する事ができます。コイルを自作する場合の目安としては便利かもしれません。ただしこの近似計算の精度はあまり良くなく、また現実には工作精度の問題もあるので、ある程度の誤差を覚悟してください。

○ＬＣマッチ
~~~~~~~~~~~~
　最も簡単なＬＣマッチング回路の回路構成と各パラメータを表示します。ホイップやバーチカル等のマッチングをとる際は便利かも知れません。各素子の下側に表示しているリアクタンスの値が極端に小さい場合は、その素子をショート、逆に極端に大きい場合はその素子は開放（接続しない）しているのと同じと考えてください。

　この計算を利用して屋外設置型のオートアンテナチューナ（ＡＴＵ）を使用する場合に、ＬとＣの組み合わせがどのようになるかをある程度想像する事ができます。

　計算では素子の損失抵抗成分は無視されています。一般的には素子のＬやＣの値が大きい程、その損失（Ｒ）も大きく、またＣよりはＬのほうが損失が遥かに大きいと考えられますので、できるだけＬが小さくなるような回路を選択すると良いでしょう。

○分布定数線路
~~~~~~~~~~~~~~
　分布定数線路（はしごフィーダや同軸ケーブル）を使用した場合のインピーダンスおよびＱマッチセクション、直列マッチセクションの計算を行います。これらの計算は従来はスミスチャートを利用していましたが、使い方をすぐに忘れるのでパソコンに頼る事にしました（Hi）。

　インピーダンス計算では任意の線路長のフィーダを接続した場合の、出力端（右側）に対する入力端（左側）のインピーダンス、または入力端に対する出力端のインピーダンスを計算します。これを利用して、ノイズブリッジ等を使って任意長の同軸ケーブルを介してインピーダンス測定を行った場合の、アンテナのインピーダンスを求める事ができます。ＳＷＲは入力端のインピーダンスから計算した値ですので、線路に減衰があると小さくなります。線路の減衰（dB）は使用するケーブルの長さおよび周波数からハンドブック等の換算表等で求めると良いでしょう。

　Ｑマッチセクションはケーブルを１本、直列マッチングセクションは２本直列に組み合わせたもので、「ＴＵＮＥ」ボタンを押すと、入力端での（Ｒｉに対する）ＳＷＲが最小となる線路長を求めます。Ｑマッチセクションを計算する場合はＲｉとフィーダ１のインピーダンスを同じ値にして「ＴＵＮＥ」ボタンを押して下さい。この計算では線路は無損失と仮定されます。なお中間点および入力端のインピーダンスを上側のインピダーンス計算の枠に表示計算しますので、より微細に検討したい場合はそちらも参考にすると良いでしょう。

　線路長（Ｌ）は電気長表記で、波長短縮率が効いてきますので、物理長を求める場合は、使用するフィーダの波長短縮率を掛けて下さい。

○スタブマッチ
~~~~~~~~~~~~~~
　スタブマッチ（トラップマッチ）を計算します。ＺＬは負荷（アンテナ）のインピーダンス、ＺｏはＬ１とＬ２に使用するフィーダの特性インピーダンス、Ｚｉはそこに接続する給電フィーダの特性インピーダンスで、ＳＷＲは給電フィーダの特性インピーダンスを基準として計算します。短縮率と周波数ｆはＬ１、Ｌ２の長さ（cm）の計算に影響します。
　「ＴＵＮＥ」ボタンを押すと、ＳＷＲが最も低くなるＬ１とＬ２を計算して表示します。最大で２つの解を表示しますが、見つからない場合もあります。

Ｌ１	負荷からスタブ接続位置までの距離
ＺＳ	スタブ接続位置のインピーダンス（スタブ未接続の場合の）
ＸＳ	スタブのリアクタンス
Ｌ２ｓ	スタブの長さ（ショートスタブ）
Ｌ２ｏ	スタブの長さ（オープンスタブ）
Ｚｉ	給電インピーダンス（ＳＷＲ計算インピーダンス）

　スタブはショートスタブが使用される事が多いですが、短くて済む場合はキャパシティブなオープンスタブが使われる場合もあります。
　スタブに集中定数を使用する事もできます。この場合はＸＳのインダクタンス（コイル）またはキャパシタンス（コンデンサ）を接続します。

○スタブ
~~~~~~~~
　はしごフィーダや同軸ケーブルをスタブとして使用する場合のＸ、Ｌ、Ｃの値を計算します。
　なお、各ケーブルの短縮率と特性インピーダンスは各種の資料を参照しましたが、資料によりマチマチですので、代表的と思われるものを使用してあります。不都合がある場合はケーブルの種類に「任意」を選択すると、これらの値を手動で設定する事ができます。参考までに計算式を以下に示します。

  ショートスタブ	X = Zo･tan(2πl/λ)
　オープンスタブ	X = -Zo･cot(2πl/λ)

  なお自作のはしごフィーダは以下の式で特性インピーダンスが得られるとされています（短縮率は0.96～0.99のようです）。

  Zo = 276･log10(2D/d)   D:間隔, d:ワイヤの直径


○環境設定
~~~~~~~~~~
「Ｆ／Ｂ比の後方範囲」
　Ｆ／Ｂ比を計算する際の後方の範囲を設定します。
　水平は真後ろの幅の角度で、例えばプラスマイナス６０°の範囲をチェックしたい場合は１２０を設定します。この値は０～３５９まで設定できますので、２７０とかを設定して前方サイドの輻射をバックと判定させる事もできます。
　垂直は０を設定するとピーク仰角の対象逆側でのチェックのみ（水平チェックと結果的に同じ）ですが、０以外の値を設定すると、後方を０°として、指定した角度までをチェックします。例えば９０を設定すると、後方の水平線０°から真上の９０°までチェックされます。この値は０～１７９まで設定できますので、１２０とかを設定して前方の高角度輻射をバックとして判定させる事もできます。

「ＳＷＲ計算Ｚ」
　ＳＷＲ計算の際の給電インピーダンスを設定します。デフォルトは５０Ωです。

  Ver1.58以降のＭＭＡＮＡでは基準インピーダンスにｊＸを設定することもできます。これにより何らかのマッチングを取った状態でのＳＷＲを表示することができます。（この場合に想定されるマッチング回路は広帯域な動作になりますので、周波数がずれた点でのSWRは、現実のマッチング回路を使用した場合とは異なる結果になりますが、アマチュアバンドのように狭い周波数範囲ではその差はごく僅かです）。

  「ヘアピンマッチ」ボタンを押し、最終的な整合目標のＺを入力すると、ヘアピンマッチを想定して、現在設定されている基準ＲからｊＸの値を自動的に計算します。キャパシタンスマッチを想定する場合は得られたｊＸの符号をプラスにすればＯＫです。いずれの場合も「基準Ｒ＜整合目標のＺ」の関係でなければなりません。


「電流分布の方向の明示」
  電流分布を表示する際、電流の向きを考慮した表示にするかどうかを選択します（アンテナの構造によっては、電流の向きが正しく表示されない場合があります）。

「最新ファイル」
  ファイルメニューに表示する最新の（最近参照した）ファイルの数と、その種類を設定します。「ＭＡＡファイルのみ」のチェックを外すと、「ＭＡＢ」「ＭＡＯ」ファイルも表示されます。

「最大パルス数」
  扱うことのできる最大パルス数を設定します。デフォルトは１２８０です。最大８１９２まで設定できますが、仮想記憶を含めたシステムのメモリ量が少ないとメモリエラーが発生し、少ないパルス数しか確保できなくなります。また物理メモリが少なくて計算中にスワップが発生する場合は実用は難しいかも知れません。

  参考までにインピーダンスマトリックスが消費するメモリ量を以下に示します。

	パルス	メモリ量
	1024	8MB
	2048	32MB
	4096	128MB
	8192	512MB

  現在の標準的なパソコンのパワーでは１０００パルスを超えたあたりから計算速度が我慢できなくなると思います。あまり多くのパルス数を確保しても無駄ですので、必要最小限に留めておくと良いでしょう。

----------------------
13．扱うファイル
----------------------
○アンテナ定義ファイル
~~~~~~~~~~~~~~~~~~~~~~
　ワイヤ定義、給電点、集中定数等を記録したテキストファイルです。このファイルは外部のエディタでも編集する事ができます。各パラメータの書式についてはＭＭＡＮＡが作成したファイルを実際に見て頂ければ一目瞭然なので説明は省略します。

○結果ファイル
~~~~~~~~~~~~~~
　計算結果を記録したバイナリ形式のファイルで編集する事はできません。結果の比較を行う際に必要になります。このファイル内にはその結果に対するアンテナ定義も記録されています。
  なおこの形式のファイルはＭＭＡＮＡのバージョンアップによって以前のものが読めなくなる可能性があります。

○最適化シート
~~~~~~~~~~~~~~
　最適化のパラメータや最適化結果の一覧等を記録したバイナリ形式のファイルで編集する事はできません。最適化を実行した後は一覧も記録されていますので、後から自分の気に入った結果のアンテナ定義に更新する事もできます。このファイル内にはその最適化を行った際のアンテナ定義も記録されています。
  なおこの形式のファイルはＭＭＡＮＡのバージョンアップによって以前のものが読めなくなる可能性があります。

○電流ファイル
~~~~~~~~~~~~~~
　パルス番号や座標位置に対する電流値や位相を記録したテキストファイルです。ＣＳＶ形式ですので、「Microsoft Excel」等の市販の表計算ソフトでも参照できます。各行は以下の形式で記録されます。

　ﾜｲﾔ番号,ﾊﾟﾙｽ番号,Ｘ,Ｙ,Ｚ,電流（実部）,電流（虚部）,電流（絶対値）,位相

	Ｘ，Ｙ，Ｚ	単位ｍ
	電流		単位Ａ
	位相		単位°

○近傍データファイル
~~~~~~~~~~~~~~~~~~~~~~
　近傍の直交座標位置に対する電界強度または磁界強度を記録したテキストファイル（ＣＳＶ形式）です。各行は以下の形式で記録されます。

　Ｘ,Ｙ,Ｚ,ﾍﾞｸﾄﾙ,電界強度（実部）,電界強度（虚部）,電界強度（絶対値）,位相
　Ｘ,Ｙ,Ｚ,ﾍﾞｸﾄﾙ,磁界強度（実部）,磁界強度（虚部）,磁界強度（絶対値）,位相

	Ｘ，Ｙ，Ｚ	単位ｍ
	電界強度	単位Ｖ／ｍ
	磁界強度	単位ＡＴ／ｍ
	位相		単位°

  Ver1.77以降のMMANAでは記録される値は実効値です。Ver1.76以前はピーク値を記録していました。（MNI TNX JH1DGF）


○遠傍データファイル
~~~~~~~~~~~~~~~~~~~~~~
　径度（方位角）、天頂角に対する絶対利得（dBi）を記録したテキストファイル（ＣＳＶ形式）です。各行は以下の形式で記録されます。

　天頂角,径度,垂直偏波,水平偏波,両偏波合算

	天頂角，径度	単位°
	利得		単位dBi

○周波数特性データファイル
~~~~~~~~~~~~~~~~~~~~~~~~~~
　ユーザが指定する周波数範囲と間隔で、R,jX,SWR,GA,F/Bの各値を記録したテキストファイル（ＣＳＶ形式）です。


----------------------
最後に
----------------------
　私は団地に住むアパマンハムで、現在ベランダにスモールループ（磁気ループ）と釣り竿を使ったバーチカルを取り付けて使っています。このような環境下ではＨＦローバンドを運用するにはどうしてもローディングコイル等の集中定数のお世話になりますので、そのあたりを便利にと思ってこのソフトを作成しました。
　しかし実際にいろいろと試してみると、ＭＩＮＩＮＥＣでは建物の鉄骨をグランドにしている場合の定義方法や、その建物自体の影響等を含めた解析は、ある程度モデル化して解析はできるかも知れませんが、やはり無理があるように感じています。
　また集中定数にしても、現実にはある程度の大きさがありますので、その形状を含めた解析はできません。
　ただ新しくアンテナを自作する際、その寸法や集中定数の値がどうなるか、またどの程度の性能が得られるかをある程度の範囲で推測する事はできますので、まったく役に立たないという訳ではなさそうです。
　私のアンテナの興味の方向が、上記のようにかなり限られているので、いろいろな面で不備な点があるとは思いますが、このソフトが皆さんのアンテナの自作に少しでもお役に立てば幸いに思います。

　なお私はごく個人的な範囲で趣味としてアマチュア無線を楽しんでおります。あくまでアマチュアで、アンテナの専門家ではありませんので、まだまだ良く判らない点が多くあります。本書や、本ソフト上の処理方法に誤りがあるとお気付きの場合は、ぜひご指導頂けたらと思います。

----------------------
ＭＭＡＮＡの配布
----------------------
　ＭＭＡＮＡはフリーソフトとして公開します。著作権はＪＥ３ＨＨＴが所持しますが、コピー、配布に関して制限を設けません。みなさんの良識を信用します。問い合わせも不要です。ただしＭＭＡＮＡを使用して発生した損害についてはいかなる場合も保証できませんのでご了承下さい。

　最新版は以下のＵＲＬからダウンロードできます。

http://plaza27.mbn.or.jp/~je3hht/mmana


　ＭＭＡＮＡに関するご要望やご質問はＪＥ３ＨＨＴ宛に郵便もしくはE-Mailでお願いいたします（E-Mail:je3hht@jarl.com）。ただしアンテナに関する難しい質問は勘弁してね！ Hi

　　　　　　　　　　　　　　　　　　　　　　　　　　ＪＥ３ＨＨＴ  森　　誠
